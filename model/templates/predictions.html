<!--<!doctype html>-->
<!--<html lang="en">-->
<!--  <head>-->
<!--    <meta charset="utf-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">-->
<!--    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">-->
<!--    <title>Predictions</title>-->
<!--  </head>-->
<!--  <body>-->
<!--    <div class="container">-->
<!--      <h1 class="my-4">Predicted Quantities for Next Week</h1>-->
<!--      {% for city, table in city_tables %}-->
<!--        <h2>{{ city }}</h2>-->
<!--        <div class="table-responsive">-->
<!--          {{ table|safe }}-->
<!--        </div>-->
<!--      {% endfor %}-->
<!--    </div>-->
<!--    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>-->
<!--    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>-->
<!--    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>-->
<!--  </body>-->
<!--</html>-->



<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Predictions</title>-->
<!--    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">-->
<!--</head>-->
<!--<body>-->
<!--<div class="container">-->
<!--    <h1>Predicted Sales Report</h1>-->
<!--    <table class="table table-striped">-->
<!--        <thead>-->
<!--        <tr>-->
<!--            <th>City</th>-->
<!--            <th>Product</th>-->
<!--            <th>Predicted Quantity Ordered</th>-->
<!--        </tr>-->
<!--        </thead>-->
<!--        <tbody>-->
<!--        {% for prediction in predictions %}-->
<!--            <tr>-->
<!--                <td>{{ prediction.city }}</td>-->
<!--                <td>{{ prediction.product }}</td>-->
<!--                <td>{{ prediction.quantity }}</td>-->
<!--            </tr>-->
<!--        {% endfor %}-->
<!--        </tbody>-->
<!--    </table>-->
<!--</div>-->
<!--</body>-->
<!--</html>-->


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Predictions</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="container">
    <h1>Predicted Sales Report</h1>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>City</th>
            <th>Product</th>
            <th>Predicted Quantity Ordered</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        {% for prediction in predictions %}
        <tr>
            <td>{{ prediction.city }}</td>
            <td>{{ prediction.product }}</td>
            <td>{{ prediction.predicted_quantity }}</td>
            <td>
                <button class="btn btn-primary" onclick="showChart('{{ prediction.city }}', '{{ prediction.product }}', {{ prediction.historical_sales | tojson }}, {{ prediction.start_week}})">Show Chart</button>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<!-- Modal for displaying the chart -->
<div class="modal fade" id="chartModal" tabindex="-1" role="dialog" aria-labelledby="chartModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="chartModalLabel">Historical Sales Chart</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <canvas id="salesChart" width="800" height="800"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
let chartInstance = null;

function showChart(city, product, historicalSales, startWeek) {
    const ctx = document.getElementById('salesChart').getContext('2d');

    // Destroy the previous chart instance if it exists
    if (chartInstance) {
        chartInstance.destroy();
    }

    chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
            labels: Array.from({length: historicalSales.length}, (_, i) => startWeek + i),
            datasets: [{
                label: `${product} Sales in ${city}`,
                data: historicalSales,
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1,
                fill: false
            }]
        },
        options: {
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Week'
                    }
                },
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Sales'
                    }
                }
            },
            responsive: true,
            maintainAspectRatio: false,

        }
    });

    $('#chartModal').modal('show');
}
</script>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</body>
</html>